# Standard Gateway API Header Modifier Test
# ═══════════════════════════════════════════════════════════════════════════
#
# Purpose: Demonstrate PORTABLE header modification using standard Gateway API
#          (works with any Gateway API implementation, not just KGateway)
#
# Comparison:
#   - THIS FILE: Standard Gateway API (HTTPRoute.RequestHeaderModifier/ResponseHeaderModifier)
#   - 02-comprehensive-test-trafficpolicy.yaml: KGateway-specific (TrafficPolicy.headerModifiers)
#
# NGINX Equivalent:
#   configuration-snippet: |
#     more_set_input_headers 'Accept: text/plain';
#     more_set_headers 'X-Cluster-Name: kgateway-test';
#
# Reference: https://gateway-api.sigs.k8s.io/guides/http-header-modifier/
#
# ═══════════════════════════════════════════════════════════════════════════

---
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: standard-header-modifier-route
  namespace: ingress2kgateway
  labels:
    app: standard-header-test
    test-type: gateway-api-standard
    portability: upstream-compatible
spec:
  parentRefs:
  - name: external-gateway
    namespace: ingress2kgateway
    sectionName: https
  
  hostnames:
  - "i2g.${DOMAIN}"
  
  rules:
  # ═══════════════════════════════════════════════════════════════════════
  # Test Route: Standard Gateway API Header Modification
  # ═══════════════════════════════════════════════════════════════════════
  #
  # Request Headers Modified:
  #   - Set Accept: text/plain (overwrites any existing value)
  #   - Add X-Gateway-Version: standard-api
  #
  # Response Headers Modified:
  #   - Add X-Cluster-Name: kgateway-test
  #   - Add X-Gateway-Type: standard
  #
  # ═══════════════════════════════════════════════════════════════════════
  - matches:
    - path:
        type: PathPrefix
        value: "/api/standard/headers/"
    
    filters:
    # Request Header Modification (Standard Gateway API)
    # Replaces: NGINX configuration-snippet with more_set_input_headers
    - type: RequestHeaderModifier
      requestHeaderModifier:
        set:
        - name: Accept
          value: "text/plain"
        add:
        - name: X-Gateway-Version
          value: "standard-api"
    
    # Response Header Modification (Standard Gateway API)
    # Replaces: NGINX configuration-snippet with more_set_headers
    - type: ResponseHeaderModifier
      responseHeaderModifier:
        add:
        - name: X-Cluster-Name
          value: "kgateway-test-standard"
        - name: X-Gateway-Type
          value: "standard"
    
    backendRefs:
    - name: echo-server
      port: 8080

# ═══════════════════════════════════════════════════════════════════════════
# COMPARISON: Two Ways to Modify Headers
# ═══════════════════════════════════════════════════════════════════════════
#
# ┌─────────────────────────────────────────────────────────────────────────┐
# │ METHOD 1: Standard Gateway API (THIS FILE)                              │
# │ ────────────────────────────────────────────────────────────────────────│
# │ API: gateway.networking.k8s.io/v1 HTTPRoute                             │
# │ Portability: ✅ Works with ANY Gateway API implementation               │
# │                                                                         │
# │ Filters:                                                                │
# │   - RequestHeaderModifier: add, set, remove request headers             │
# │   - ResponseHeaderModifier: add, set, remove response headers           │
# │                                                                         │
# │ Reference: https://gateway-api.sigs.k8s.io/guides/http-header-modifier/ │
# └─────────────────────────────────────────────────────────────────────────┘
#
# ┌─────────────────────────────────────────────────────────────────────────┐
# │ METHOD 2: KGateway TrafficPolicy (02-comprehensive-test-trafficpolicy)  │
# │ ────────────────────────────────────────────────────────────────────────│
# │ API: gateway.kgateway.dev/v1alpha1 TrafficPolicy                        │
# │ Portability: ❌ KGateway-specific (vendor lock-in)                      │
# │                                                                         │
# │ Fields:                                                                 │
# │   - headerModifiers.request: add, set, remove request headers           │
# │   - headerModifiers.response: add, set, remove response headers         │
# │                                                                         │
# │ Note: Same functionality, different API. Use when you need other        │
# │       TrafficPolicy features (CORS, rate limiting, etc.)                │
# └─────────────────────────────────────────────────────────────────────────┘
#
# ═══════════════════════════════════════════════════════════════════════════
# RECOMMENDATION
# ═══════════════════════════════════════════════════════════════════════════
#
# Use Standard Gateway API when:
#   • Header modification is the only feature needed for this route
#   • Portability across implementations is important
#   • Minimizing vendor-specific dependencies
#
# Use KGateway TrafficPolicy when:
#   • Route already uses TrafficPolicy for other features (CORS, auth, etc.)
#   • Need features not available in standard Gateway API
#   • Committed to KGateway as the implementation
#
# ═══════════════════════════════════════════════════════════════════════════
