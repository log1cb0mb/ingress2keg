# ============================================================================
# Test 23: App Root Redirect (app-root)
# ============================================================================
#
# NGINX Equivalent:
#   nginx.ingress.kubernetes.io/app-root: /openapi-ui.html
#   nginx.ingress.kubernetes.io/app-root: /swagger-ui/index.html
#
# Purpose:
#   Redirects requests from root path (/) to a specified application path.
#   Commonly used for API documentation endpoints (e.g., /swagger-ui, /openapi-ui).
#
# Gateway API Implementation:
#   Standard HTTPRoute with RequestRedirect filter - no KGateway CRDs needed!
#   This is 100% upstream Gateway API functionality.
#
# Flow:
#   1. User requests https://approot.${DOMAIN}/
#   2. Gateway returns 302 redirect to /docs
#   3. User follows redirect to /docs
#   4. Request proceeds to backend
# ============================================================================

---
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: app-root-test-route
  namespace: ingress2kgateway
  labels:
    app: app-root-test
    test: "23"
spec:
  parentRefs:
  - name: external-gateway
    namespace: ingress2kgateway
    sectionName: https
  hostnames:
  - "approot.${DOMAIN}"
  rules:
  # ============================================================================
  # Rule 1: App Root Redirect
  # ============================================================================
  # NGINX: app-root: /docs
  # Redirects / to the main application path
  - matches:
    - path:
        type: Exact
        value: "/"
    filters:
    - type: RequestRedirect
      requestRedirect:
        path:
          type: ReplaceFullPath
          replaceFullPath: "/docs"
        statusCode: 302
  
  # ============================================================================
  # Rule 2: Application paths (catch-all)
  # ============================================================================
  - matches:
    - path:
        type: PathPrefix
        value: "/"
    backendRefs:
    - name: echo-server
      port: 8080
